---
apiVersion: sedai.dev/v1alpha1
kind: ServiceLevelObjective
metadata:
  labels:
    owner: adServiceTeam
    environment: production
    app: nginx 
  name: currencyservice-slo
  namespace: google-examples
spec:
  slos:
    - target: "99"
      window: 2w
      name: "Latency"
      description: "99 % of the requests should have latency less than 100ms"
      indicator:
        raw:
          rawQueryLanguage:
            qlType: promql 
            successQuery: istio_request_duration_milliseconds_sum{destination_service_name="adservice", destination_service_namespace="google-examples"}/istio_request_duration_milliseconds_count{destination_service_name="adservice", destination_service_namespace="google-examples"}
            category: LATENCY
            latencyThreshold: "100"
            latencyOperator: le        
            sliAggregationIntervalms: "300000"
            sliAggregationStats: avg
    - target: "99"
      window: 2w
      name: "Availability"
      description: "99% of the requests should be successful"
      indicator:
        requestRatio:
          requestQueryLanguage: 
            qlType: promql 
            category: AVAILABILITY
            numeratorSuccessQuery: istio_request_duration_milliseconds_count{destination_service_name="adservice", destination_service_namespace="google-examples",response_code!~"5.*"}
            denominatorTotalQuery: istio_request_duration_milliseconds_count{destination_service_name="adservice", destination_service_namespace="google-examples"}
    - target: "99"
      window: 2w
      name: "LatencyRatio"
      description: "99% of the requests should be successful"
      indicator:
        requestRatio:
          requestQueryLanguage: 
            qlType: promql 
            category: LATENCY
            numeratorSuccessQuery: istio_request_duration_milliseconds_bucket{destination_service_name="adservice", destination_service_namespace="google-examples",le="0.1"}
            denominatorTotalQuery: istio_request_duration_milliseconds_count{destination_service_name="adservice", destination_service_namespace="google-examples"}
            sliAggregationIntervalms: "300000"

              

      
